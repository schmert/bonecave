strftime(format='%w')
return(tmp)
}
month_of_year = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%m')
return(tmp)
}
for (i in seq(state)[1:2]) {
this_state  = state[i]
this_region = region[i]
print(this_state)
fname = paste0('DN',this_state,'2015.dbc')
tmp   = read.dbc(fname) %>%
filter(PARTO %in% 1:2, SEXO %in% 1:2)  %>%
mutate(doy = day_number(DTNASC),
month = month_of_year(DTNASC),
dow = day_of_week(DTNASC),
parto = factor(PARTO, levels=1:2,
labels=c('Vaginal','Cesarian'))) %>%
group_by(month, SEXO) %>%
summarize(births=n()) %>%
ungroup() %>%
mutate(state=this_state, region=this_region)
B = rbind(B, tmp)
}
rm( list=ls() )
graphics.off()
windows(record=TRUE)
library(read.dbc)
library(tidyverse)
#---------------------------------------
# US data (2015)
#---------------------------------------
url = 'http://vincentarelbundock.github.io/Rdatasets/csv/mosaicData/Births2015.csv'
US  = read.csv(url, header=TRUE,stringsAsFactors = FALSE) %>%
mutate( country     = 'USA',
doy         = day_of_year,
prop_births = births/sum(births)) %>%
select(country,doy,prop_births)
#---------------------------------------
# Brazil data (2015)
# this has to be processed state by state
#---------------------------------------
state = c("AC", "AL", "AM", "AP", "BA",
"CE", "DF", "ES", "GO", "MA",
"MG", "MS", "MT", "PA", "PB",
"PE", "PI", "PR", "RJ", "RN", "RO",
"RR", "RS", "SC", "SE", "SP", "TO")
region = c('N','NE','N','N','NE',
'NE','CW','SE','CW','NE',
'SE','CW','CW','N','NE',
'NE','NE','S','SE','NE','N',
'N','S','S','NE','SE','CW'
)
geo = data.frame( i=seq(state), state, region)
B = data.frame()
day_number = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%j') %>%
as.numeric()
return(tmp)
}
day_of_week = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%w')
return(tmp)
}
for (i in seq(state)) {
this_state  = state[i]
this_region = region[i]
print(this_state)
fname = paste0('DN',this_state,'2015.dbc')
tmp   = read.dbc(fname) %>%
filter(PARTO %in% 1:2) %>%
mutate(doy = day_number(DTNASC),
dow = day_of_week(DTNASC),
parto = factor(PARTO, levels=1:2,
labels=c('Vaginal','Cesarian'))) %>%
group_by(parto,dow,doy) %>%
summarize(births=n()) %>%
ungroup() %>%
mutate(state=this_state, region=this_region)
B = rbind(B, tmp)
}
BR = B %>%
group_by(doy) %>%
summarize(births = sum(births)) %>%
ungroup() %>%
mutate(country='Brazil',
prop_births = births/sum(births)) %>%
select(country, doy, prop_births)
df = rbind( BR,
US)
ggplot(data=df, aes(x=doy, y=prop_births,
color=country, group=country,
fill=country)) +
geom_point(alpha=.30)  +
lims(y=c(.0015,.0035)) +
geom_smooth(alpha=.20, span=.60) +
theme_bw() +
labs(title='Seasonal Pattern of Births, Brazil and USA 2015',
x='Day of Year',y='Proportion of Annual Births') +
scale_x_continuous(breaks=c(1,91,182,274),
minor_breaks = NULL,
labels=c('1 Jan','1 Apr',
'1 Jul','1 Oct'))
ggsave(file='seasonality comparison.png',
width=11, height=8.5)
rm( list=ls() )
graphics.off()
windows(record=TRUE)
library(read.dbc)
library(tidyverse)
#---------------------------------------
# Brazil data (2015)
# this has to be processed state by state
#---------------------------------------
state = c("AC", "AL", "AM", "AP", "BA",
"CE", "DF", "ES", "GO", "MA",
"MG", "MS", "MT", "PA", "PB",
"PE", "PI", "PR", "RJ", "RN", "RO",
"RR", "RS", "SC", "SE", "SP", "TO")
region = c('N','NE','N','N','NE',
'NE','CW','SE','CW','NE',
'SE','CW','CW','N','NE',
'NE','NE','S','SE','NE','N',
'N','S','S','NE','SE','CW'
)
geo = data.frame( i=seq(state), state, region)
B = data.frame()
day_number = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%j') %>%
as.numeric()
return(tmp)
}
day_of_week = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%w')
return(tmp)
}
month_of_year = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%m')
return(tmp)
}
for (i in seq(state)) {
this_state  = state[i]
this_region = region[i]
print(this_state)
fname = paste0('DN',this_state,'2015.dbc')
tmp   = read.dbc(fname) %>%
filter(PARTO %in% 1:2, SEXO %in% 1:2)  %>%
mutate(doy = day_number(DTNASC),
month = month_of_year(DTNASC),
dow = day_of_week(DTNASC),
parto = factor(PARTO, levels=1:2,
labels=c('Vaginal','Cesarian'))) %>%
group_by(month, SEXO) %>%
summarize(births=n()) %>%
ungroup() %>%
mutate(state=this_state, region=this_region)
B = rbind(B, tmp)
}
head(B)
as.numeric(B$month)
dim(B)
BR = B %>%
group_by(month) %>%
summarize(SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
select(country, month, SRAB)
BR = B %>%
group_by(month) %>%
summarize(SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
select(month, SRAB)
BR
BR
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize(SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
select(month, SRAB)
BR
ggplot(data=BR, aes(x=month, y=SRAB) +
geom_point(alpha=.30)  +
geom_smooth(alpha=.20, span=.60) +
theme_bw()
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_smooth(alpha=.20, span=.60) +
theme_bw()
ggplot(data=BR, aes(x=month, y=SRAB))
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_smooth(alpha=.20, span=.60) +
theme_bw()
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw()
months
mo
months
month
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Seasonal Pattern of Births, Brazil and USA 2015',
x='Day of Year',y='Proportion of Annual Births') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels='Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec')
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Seasonal Pattern of Births, Brazil and USA 2015',
x='Day of Year',y='Proportion of Annual Births') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( births = sum(births),
SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
mutate( prop_births = births/sum(births)) %>%
select(month, SRAB)
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( births = sum(births),
SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
mutate( prop_births = births/sum(births)) %>%
select(month, SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
ggplot(data=BR, aes(x=prop_births, y=SRAB)) +
geom_point(alpha=.30)
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( births = sum(births),
SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
mutate( prop_births = births/sum(births))
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( births = sum(births),
SRAB = sum(births[SEXO==1])/sum(births[SEXO==2])) %>%
ungroup() %>%
mutate( prop_births = births/sum(births)) %>%
select(month, prop_births,SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
ggplot(data=BR, aes(x=prop_births, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
BR
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( SRAB = sum(births[SEXO==1])/sum(births[SEXO==2]),
births = sum(births)) %>%
ungroup() %>%
mutate( prop_births = births/sum(births)) %>%
select(month, prop_births,SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
ggplot(data=BR, aes(x=prop_births, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
#ggsave(file='seasonality comparison.png',
#       width=11, height=8.5)
ggplot(data=BR, aes(x=prop_births, y=SRAB)) +
geom_point(alpha=.30)
ggplot(data=BR, aes(x=prop_births, y=SRAB)) +
geom_point(alpha=.30)  +
theme_bw()
head(B)
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(region,month) %>%
summarize( SRAB = sum(births[SEXO==1])/sum(births[SEXO==2]),
births = sum(births)) %>%
group_by(region) %>%
mutate( prop_births = births/sum(births)) %>%
select(region,month, prop_births,SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
facet_wrap(~region) %>%
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
facet_wrap(~region)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(region,month) %>%
summarize( SRAB = sum(births[SEXO==1])/sum(births[SEXO==2]),
births = sum(births)) %>%
group_by(region) %>%
mutate( prop_births = births/sum(births)) %>%
select(region,month, prop_births,SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( SRAB = sum(births[SEXO==1])/sum(births[SEXO==2]),
births = sum(births)) %>%
ungroup() %>%
mutate( prop_births = births/sum(births)) %>%
select(month, prop_births,SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
rm( list=ls() )
graphics.off()
windows(record=TRUE)
library(read.dbc)
library(tidyverse)
#---------------------------------------
# Brazil data (2015)
# this has to be processed state by state
#---------------------------------------
state = c("AC", "AL", "AM", "AP", "BA",
"CE", "DF", "ES", "GO", "MA",
"MG", "MS", "MT", "PA", "PB",
"PE", "PI", "PR", "RJ", "RN", "RO",
"RR", "RS", "SC", "SE", "SP", "TO")
region = c('N','NE','N','N','NE',
'NE','CW','SE','CW','NE',
'SE','CW','CW','N','NE',
'NE','NE','S','SE','NE','N',
'N','S','S','NE','SE','CW'
)
geo = data.frame( i=seq(state), state, region)
B = data.frame()
day_number = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%j') %>%
as.numeric()
return(tmp)
}
day_of_week = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%w')
return(tmp)
}
month_of_year = function(x) {
tmp = as.Date(x, '%d%m%Y') %>%
strftime(format='%m')
return(tmp)
}
for (i in seq(state)) {
this_state  = state[i]
this_region = region[i]
print(this_state)
fname = paste0('DN',this_state,'2015.dbc')
tmp   = read.dbc(fname) %>%
filter(PARTO %in% 1:2, SEXO %in% 1:2)  %>%
mutate(doy = day_number(DTNASC),
month = month_of_year(DTNASC),
dow = day_of_week(DTNASC),
parto = factor(PARTO, levels=1:2,
labels=c('Vaginal','Cesarian'))) %>%
group_by(month, SEXO) %>%
summarize(births=n()) %>%
ungroup() %>%
mutate(state=this_state, region=this_region)
B = rbind(B, tmp)
}
BR = B %>%
mutate(month=as.numeric(month)) %>%
group_by(month) %>%
summarize( SRAB = sum(births[SEXO==1])/sum(births[SEXO==2]),
births = sum(births)) %>%
ungroup() %>%
mutate( prop_births = births/sum(births)) %>%
select(month, prop_births,SRAB)
ggplot(data=BR, aes(x=month, y=SRAB)) +
geom_point(alpha=.30)  +
geom_line() +
theme_bw() +
labs(title='Sex Ratio at Birth, Brazil 2015',
x='Day of Year',y='Males/Females') +
scale_x_continuous(breaks=c(1:12),
minor_breaks = NULL,
labels=c('Jan','Feb','Mar',
'Apr','May','Jun',
'Jul','Aug','Sep',
'Oct','Nov','Dec'))
ggsave(file='seasonality sex ratio.png',
width=11, height=8.5)
