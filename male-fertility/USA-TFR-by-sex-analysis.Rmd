---
title: "USA TFR by sex"
author: "Carl Schmertmann"
date: "6 Nov 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Notation

Suppose that there are $A$ reproductive ages $a=1\ldots A$ in which either men or women may have children. At some of these ages, notably 50+, male fertility may be possible even though female fertility is not. 

Call $\theta \in \mathbb{R}^A$ the vector of age-specific fertility rates for _women_. Define $\mathbf{W} = diag(W_1\ldots W_A)$ as a diagonal matrix with population counts of _women_, and $\mathbf{M} = diag(M_1\ldots M_A)$ as a diagonal matrix with population counts of _men_. 

Define an $A \times A$ matrix $\mathbf{P}$ in which 
$$
P_{ij} = \text{fraction of births to mothers aged $j$ that have fathers aged $i$}
$$
Notice that the column sums of $\mathbf{P}$ equal one by definition: $\mathbf{1}^\prime \mathbf{P}  = \mathbf{1}^\prime$, where $\mathbf{1}$ is an $A \times 1$ vector of ones. 

## Age-Specific Births

The vector of births arranged by age of _mothers_ is
$$
b_{female} = \mathbf{W}\,\theta
$$
and the vector of births arranged by age of _fathers_ is
$$
b_{male} = \mathbf{P}\,\mathbf{W}\,\theta
$$

## Age- and Sex-Specific Birth Rates

Birth rates for women are age-specific birth/women ratios:
$$
f_{female} = \mathbf{W}^{-1}\,b_{female} = \mathbf{W}^{-1}\,\mathbf{W}\,\theta = \theta
$$
Birth rates for men are age-specific birth/men ratios:
$$
f_{male} = \mathbf{M}^{-1}\,b_{male} = \mathbf{M}^{-1}\,\mathbf{P}\,\mathbf{W}\,\theta 
$$

## Age-Specific Birth Rates and TFRs

With single-year ages, TFR is simply the sum of age-specific rates, so
$$
TFR_{female} = \mathbf{1}^\prime \, \theta
$$
and
$$
TFR_{male} = \mathbf{1}^\prime \mathbf{M}^{-1} \mathbf{P} \mathbf{W}\,\theta
$$
The difference of the sex-specific $TFR$s is
$$
TFR_{male} - TFR_{female} = \mathbf{1}^\prime \left[\, \mathbf{M}^{-1} \mathbf{P} \mathbf{W}\,- \mathbf{I}_A\,\right]\theta
$$
In very broad terms, we can see that this difference is more likely to be positive (higher male TFR) if there are more women and fewer men in the reproductive-age population -- i.e. if the diagonal elements of $\mathbf{W}$ tend to be larger than the diagonal elements of $\mathbf{M}$. In that case the general fertility rate for males (total period births divided by total number of reproductive-age males) would be higher than the general fertility rate for females, and the $TFR$s would tend to have the same difference in favor of males. 

More subtly, the age distributions of males and females also affect the difference in sex-specific $TFR$s. 


```{r}
# USA male fertility
# from Dudel, C. and S. Klüsener. Male fertility data for high-income 
# countries [unpublished data]. Submitted to the HFC by C. Dudel 
# on 15.05.2019.
# 
# downloaded from Human Fertility Collection 2 Nov 2019
# https://www.fertilitydata.org/data/RAW_DATA/m_USA_51.zip




library(tidyverse)

# Male data from HFC, as described above
MM = read.table(file='m_ASFR_USA.txt', header=TRUE) %>%
      mutate(Y = factor(Year)) 

# Female data from HFD
FF = read.table(file='USAasfrTR.txt', skip=2, header=TRUE) %>%
       filter(Year %in% unique(MM$Year)) %>%
       mutate(Age = 11 + as.numeric(Age)) %>%
       group_by(Year,Age) %>%
       summarize(ASFR = mean(ASFR)) %>%
       mutate(Y=factor(Year))

big = bind_rows(
         mutate(MM,Sex='Male'),
         mutate(FF,Sex='Female')
       )
       
tmp = big %>%
           group_by(Sex,Year) %>%
           summarize(TFR=sum(ASFR))

theme_carl <- function () { 
  theme_bw(base_size=13) %+replace% 
    theme(
      title      = element_text(size=20, face='bold'),
      plot.caption  = element_text(size=10, face='italic',hjust=0),
      axis.text  = element_text(size=15, face='bold'),
      axis.title = element_text(size=15, face='bold')
    )
}

tmp = big %>%
  filter(Year > 1974) %>%
  group_by(Sex,Year) %>%
  summarize(TFR=sum(ASFR))

G = ggplot(data=tmp) +
      aes(x=Year, y=TFR, group=Sex, color=Sex) +
      geom_line(lwd=1) +
      geom_point() +
      geom_point(x=1988, y=1.925, shape=1, size=9, color='purple') +
      geom_hline(yintercept = 2, lty='dotted') +
      scale_color_manual(values=c('red','blue')) +
      scale_x_continuous(breaks=seq(1975,2015,5)) +
      labs(x='Year',
           y='Total Fertility Rate',
           title='Period Total Fertility 1975-2015\nUSA Males and Females',
           caption='Sources\nMALES: C Dudel and S Klüsener, Human Fertilty Collection https://www.fertilitydata.org/data/RAW_DATA/m_USA_51.zip\nFEMALES: Human Fertility Database') +
      theme_carl()


print(G)

#ggsave(G, file='USA-TFR-by-sex.png', height=8, width=11, units='in', dpi=300)

```