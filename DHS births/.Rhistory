set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
# read basic files
ddi    = read_ipums_ddi("idhs_00002.xml")
Births = read_ipums_micro(ddi)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
# Keep only Kenya 2014
Moms <- Births %>%
filter(COUNTRY==404, YEAR==2014) %>%
select(CASEID,
mombirth = BIRTHYEAR,
kid      = BIDX,
kidbirth = KIDBIRTHYR)
# identify parity-zero women who are not represented
# in the births file
Childless = Women %>%
filter(CHEB==0) %>%
select(CASEID, mombirth = BIRTHYEAR) %>%
mutate(kid      = NA,
kidbirth = NA)
Kenya = rbind(Moms, Childless) %>%
mutate(woman = as.numeric( as.factor( CASEID)))
# random sample of women
n    = 2000
W    = max(Kenya$woman)
selected_women = sample(W, n)
Kenya_sample = Kenya %>%
filter(woman %in% selected_women) %>%
mutate(m=kidbirth - mombirth)
# lowest year at which any selected mom turned 12
min_age    = 12
first_year = min_age + min(Kenya_sample$mombirth)   # something like 1978
last_year  = max(Kenya_sample$kidbirth, na.rm=TRUE) # almost surely 2014
first_year:last_year
history = data.frame()
for (this_year in first_year:last_year) {
# figure out eacn mom's status in this year
tmp = Kenya_sample %>%
mutate(year = this_year,
age  = (this_year-mombirth),
birth = (age==m)) %>%
filter( age >= min_age) %>%
group_by(woman, year) %>%
summarize(age    = age[1],
birth  = (sum(birth)>0),
parity = sum(m <= age, na.rm=TRUE)) %>%
ungroup()
history = rbind(history,
tmp)
}
history = arrange(history, year, woman)
graphics.off()
windows(record=TRUE)
for (this_year in first_year:last_year) {
counts = history %>%
filter(year <= this_year) %>%
group_by(age,parity) %>%
summarize(n=n())
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(min_age,50,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title=this_year) +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
}
filter(history, year==2014)
filter(history, year==2014) %>% nrow()
filter(history, year==2014) %>% table(age)
filter(history, year==2014) %>% group_by(age) %>% summarise(n=n())
names(Kenya)
table(Kenya$mombirth)
names(Women)
Women %>% group_by(AGE,CHEB) %>% summarize(n=sum(PERWEIGHT))
Women %>% group_by(AGE,CHEB) %>% summarize(n=sum(PERWEIGHT)) -> z
head(z)
View(z)
sum(z)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
head(countes)
head(counts)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(min_age,50,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title=this_year) +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(min_age,50,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(min_age,50,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(min_age,50,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
ggave( file='age-parity-distribution-Kenya-2014-DHS.png')
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(min_age,50,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
ggsave( file='age-parity-distribution-Kenya-2014-DHS.png')
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
ggsave( file='age-parity-distribution-Kenya-2014-DHS.png')
setwd("~/GitHub/bonecave/DHS births")
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
ggsave( file='age-parity-distribution-Kenya-2014-DHS.png')
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
png(file='age-parity-distribution-Kenya-2014-DHS.png',
height=8, width=8)
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
dev.off()
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
png(file='age-parity-distribution-Kenya-2014-DHS.png',
height=8, width=8, units='in')
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
dev.off()
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
png(file='age-parity-distribution-Kenya-2014-DHS.png')
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(history$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
dev.off()
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
png(file='age-parity-distribution-Kenya-2014-DHS.png')
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(counts$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
dev.off()
head(Women)
head(Women$COUNTRY)
head(Women$COUNTRY)
table(Women$COUNTRY)
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 02 Feb 2019
#
# construct year-by-year parity histories for a sample of women
# from the Kenya 2014 DHS (83591 births to 23245 women)
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
filter(COUNTRY==404) %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
png(file='age-parity-distribution-Kenya-2014-DHS.png')
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='royalblue', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(counts$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Kenya 2014 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
dev.off()
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
table(Women$COUNTRY)
counts = Women %>%
filter(COUNTRY==686) %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
head(countes)
head(counts)
Women %>%
filter(COUNTRY==686)
Women %>%
filter(COUNTRY==686) -> z
head(z)
View(z)
####################################################################
# Carl Schmertmann
# created 02 Feb 2019
# altered 03 Feb 2019
####################################################################
set.seed(6447100)
if (!require("ipumsr")) stop("Reading IPUMS data into R requires the ipumsr package. It can be installed using the following command: install.packages('ipumsr')")
library(tidyverse)
ddi    = read_ipums_ddi("idhs_00003.xml")
Women  = read_ipums_micro(ddi)
counts = Women %>%
filter(COUNTRY==686) %>%
group_by(AGE,CHEB) %>%
summarize(n=sum(PERWEIGHT)) %>%
rename(age=AGE, parity=CHEB)
png(file='age-parity-distribution-Senegal-2017-DHS.png')
G =
ggplot( data=counts,
aes(x=parity, y=age, size=n)) +
geom_point(shape=16, color='orangered', alpha=.50) +
scale_size_continuous(range=c(0,15)) +
scale_y_continuous(breaks=seq(15,49,2)) +
scale_x_continuous(breaks=0:max(counts$parity)) +
labs(title='Distribution of Women by Age and Parity',
subtitle='Senegal 2017 DHS',
x='# children ever born',
caption='Source: IPUMS-DHS, https://www.idhsdata.org/idhs/') +
guides(color=FALSE, shape=FALSE,size=FALSE) +
theme_bw()
print(G)
dev.off()
