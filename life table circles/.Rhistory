tmp = I %>%
mutate(agroup = 5*floor(age/5)) %>%
filter(chborn>0) %>%
group_by(agroup) %>%
summarize(W=n(),
D = sum(chdead),
B = sum(chborn),
q = D/B)
tmp
filter(I, age < 20)
filter(I, age < 20, chborn > 0)
table(I$chborn)
tmp = I %>%
mutate(agroup = 5*floor(age/5)) %>%
filter(chborn>0, chborn != 99 ) %>%
group_by(agroup) %>%
summarize(W=n(),
D = sum(chdead),
B = sum(chborn),
q = D/B)
tmp
plot( seq(15,45,5), tmp$q, type='o')
windows()
plot( seq(15,45,5), tmp$q, type='o')
plot( seq(15,45,5), tmp$q, type='o', ylim=range(0,tmp$q))
tmp = I %>%
mutate(agroup = 5*floor(age/5)) %>%
filter(age >= 25, chborn>0, chborn != 99 ) %>%
group_by(agroup) %>%
summarize(W=n(),
D = sum(chdead),
B = sum(chborn),
q = D/B)
tmp
c(0,2,7,14,17,3)
sum(c(0,2,7,14,17,3))
100*c(0,2,7,14,17,3))/43
100*c(0,2,7,14,17,3)/43
round( 100*c(0,2,7,14,17,3)/43)
devtools::install_github('thomasp85/gganimate')
install.packages('Rcpp')
devtools::install_github('thomasp85/gganimate')
source('~/GitHub/bonecave/life table circles/circles.R', echo=TRUE)
setwd("~/GitHub/bonecave/life table circles")
source('~/GitHub/bonecave/life table circles/circles.R', echo=TRUE)
G
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
install.packages('gifski')
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
setwd("~/GitHub/bonecave/life table circles")
# devtools::install_github('thomasp85/gganimate')
library(tidyverse)
library(ggforce)
library(data.table)
library(gganimate)
graphics.off()
windows(record=TRUE)
D = fread('USA SWE male 2016 life tables.txt') %>%
as.data.frame() %>%
select(country, age, lx)
D$age   = 0:110    # make ages numeric
D$radix = 100000   # add radix column
## reorganize (wide)
D = D %>%
spread(key=country, value=lx)
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(tmp$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(tmp$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(tmp$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
library(gifski)
movie = animate(G, fps=4)
# devtools::install_github('thomasp85/gganimate')
library(tidyverse)
library(ggforce)
library(data.table)
library(gganimate)
graphics.off()
windows(record=TRUE)
D = fread('USA SWE male 2016 life tables.txt') %>%
as.data.frame() %>%
select(country, age, lx)
D$age   = 0:110    # make ages numeric
D$radix = 100000   # add radix column
## reorganize (wide)
D = D %>%
spread(key=country, value=lx)
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(tmp$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(tmp$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(tmp$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
source('~/GitHub/bonecave/life table circles/circles.R', echo=TRUE)
G
str(G)
exists(G)
exists('G')
movie = animate(G, fps=4)
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' ))
G
source('~/GitHub/bonecave/life table circles/circles.R', echo=TRUE)
?animate
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
str(G,2)
movie = animate(G, fps=4)
# devtools::install_github('thomasp85/gganimate')
library(tidyverse)
library(ggforce)
library(data.table)
library(gganimate)
graphics.off()
windows(record=TRUE)
D = fread('USA SWE male 2016 life tables.txt') %>%
as.data.frame() %>%
select(country, age, lx)
D$age   = 0:110    # make ages numeric
D$radix = 100000   # add radix column
## reorganize (wide)
D = D %>%
spread(key=country, value=lx)
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,inherit.aes = FALSE,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,inherit.aes = FALSE,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,inherit.aes = FALSE,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
G
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,inherit.aes = FALSE,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,inherit.aes = FALSE,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,inherit.aes = FALSE,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
G
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
G
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' ))
G
?transition_time
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_states(age)
G
movie = animate(G, fps=4)
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' ))
G
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_states(states=age)
G
G = ggplot( ) +
geom_circle(
data=D,lwd=1,lty=1,
aes(x0=0, y0=0, r=sqrt(D$radix), fill=NULL),color='black'
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$SWE), fill='SWE' ), color='gold', alpha=.30
) +
geom_circle(
data=D,
aes(x0=0, y0=0, r=sqrt(D$USA), fill='USA'), color='red', alpha=.10
) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' ))
G
View(D)
?geom_point
G = ggplot(aes(x=x,y=y) ) +
geom_point(
lwd=1,lty=1,
size=sqrt(D$radix), fill=NULL),color='black'
)
G = ggplot(aes(x=x,y=y) ) +
geom_point(
lwd=1,lty=1,
size=sqrt(D$radix), fill=NULL,color='black'
)
ggplot(data=D,aes(x=x,y=y) ) +
geom_point(
lwd=1,lty=1,
size=sqrt(D$radix), fill=NULL,color='black'
)
ggplot(data=D,aes(x=x,y=y)) +
geom_point(
lwd=1,lty=1,
size=sqrt(radix), fill=NULL,color='black'
)
G = ggplot(data=D,aes(x=x,y=y)) +
geom_point(
lwd=1,lty=1,
size=sqrt(D$radix), fill=NULL,color='black'
)
ggplot(data=D,aes(x=x,y=y)) +
geom_point(size=sqrt(D$radix), fill=NULL,color='black'
)
D$age   = 0:110    # make ages numeric
D$radix = 100000   # add radix column
D$x = D$y = 0
ggplot(data=D,aes(x=x,y=y)) +
geom_point(size=sqrt(D$radix), fill=NULL,color='black'
)
ggplot(data=D,aes(x=x,y=y)) +
geom_point(size=sqrt(D$radix), fcolor='black')
ggplot(data=D,aes(x=x,y=y)) +
geom_point(size=sqrt(D$radix), color='black')
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix), color='black')
G
G = ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix), color='black')
G
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/100, color='black')
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/10, color='black')
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, fill=NULL,color='black')
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, fill=NA,color='black')
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, shape=1,color='black')
ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, shape=1,color='black') +
geom_point(size=sqrt(D$SWE)/2, shape=16,color='gold', alpha=.30) +
geom_point(size=sqrt(D$USA)/2, shape=16,color='red',  alpha=.10)
G = ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, shape=1,color='black') +
geom_point(size=sqrt(D$SWE)/2, shape=16,color='gold', alpha=.30) +
geom_point(size=sqrt(D$USA)/2, shape=16,color='red',  alpha=.10) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
G
movie = animate(G, fps=4)
movie
# devtools::install_github('thomasp85/gganimate')
library(tidyverse)
library(ggforce)
library(data.table)
library(gganimate)
graphics.off()
windows(record=TRUE)
D = fread('USA SWE male 2016 life tables.txt') %>%
as.data.frame() %>%
select(country, age, lx)
D$age   = 0:110    # make ages numeric
D$radix = 100000   # add radix column
D$x = D$y = 0
## reorganize (wide)
D = D %>%
spread(key=country, value=lx)
G = ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, shape=1,color='black') +
geom_point(size=sqrt(D$SWE)/2, shape=16,color='gold', alpha=.30) +
geom_point(size=sqrt(D$USA)/2, shape=16,color='red',  alpha=.10) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_time(age)
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
# devtools::install_github('thomasp85/gganimate')
library(tidyverse)
library(ggforce)
library(data.table)
library(gganimate)
graphics.off()
windows(record=TRUE)
D = fread('USA SWE male 2016 life tables.txt') %>%
as.data.frame() %>%
select(country, age, lx)
D$age   = 0:110    # make ages numeric
D$radix = 100000   # add radix column
D$x = D$y = 0
## reorganize (wide)
D = D %>%
spread(key=country, value=lx)
G = ggplot(data=D,aes(x=x,y=y)) +
lims(x=c(-320,320), y=c(-320,320)) +
geom_point(size=sqrt(D$radix)/2, shape=1,color='black') +
geom_point(size=sqrt(D$SWE)/2, shape=16,color='gold', alpha=.30) +
geom_point(size=sqrt(D$USA)/2, shape=16,color='red',  alpha=.10) +
coord_fixed() +
labs(title=paste0('Survivors to age ',D$age,'\n[Outer Circle = 100,000 male births]'),
caption='Source: Human Mortality Database http://mortality.org\n2016 mortality rates',
fill = 'Country') +
theme_no_axes() +
scale_fill_manual(values=c('gold','red' )) +
transition_states(age)
movie = animate(G, fps=4)
anim_save('compare-life-tables-as-circles.gif',
animation=movie )
